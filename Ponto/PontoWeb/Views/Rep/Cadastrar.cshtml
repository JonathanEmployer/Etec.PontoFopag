@model Modelo.REP
@using PontoWeb.Helpers
@{
    ViewBag.Title = "Cadastrar Rep";

    var tipoBiometria = new List<Modelo.Utils.ItensCombo>();
    if (Model != null)
    {
        tipoBiometria = Model.ItensEquipamentoTipoBiometria;
    }
}
@using (Html.BeginForm())
{
    @Html.HiddenFor(model => model.Id, new { id = "idRep" });
    @Html.HiddenFor(model => model.Incdata);
    @Html.HiddenFor(model => model.Inchora);
    @Html.HiddenFor(model => model.Incusuario);
    @Html.HiddenFor(model => model.Altdata);
    @Html.HiddenFor(model => model.Althora);
    @Html.HiddenFor(model => model.Altusuario);
    @Html.HiddenFor(model => model.IdEquipamentoHomologado);
    @Html.HiddenFor(model => model.Relogio, new { id = "Relogio" });
    <div class="divCenter">
        <div class="panel panel-default" style="padding:0; margin-bottom:0px">
            <div class="panel-heading salvando">
                @Html.ActionLink("X", "Grid", "Rep", null, new { @class = "close" })
                <h3 class="panel-title titulo-pagina">Cadastro de Rep</h3>
            </div>
            <div class="panel-body panelConteudo" id="panelBodyFixodivCenter">
                @Html.ValidationMessage("CustomError")
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            @Html.LabelFor(model => model.Codigo, new { @class = "control-label label-sm" })
                            @Html.TextBoxFor(model => model.Codigo, new { @class = "form-control  input-sm" })
                            @Html.ValidationMessageFor(model => model.Codigo)
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            @Html.LabelFor(model => model.NumRelogio, new { @class = "control-label label-sm" })
                            @Html.TextBoxFor(model => model.NumRelogio, new { @class = "form-control  input-sm" })
                            @Html.ValidationMessageFor(model => model.NumRelogio)
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(model => model.ServicoPontoCom, new { @class = "control-label label-sm" })
                            <div class="input-group input-group-sm">

                                @Html.TextBoxFor(model => model.ServicoPontoCom, new { @class = "form-control  input-sm", id = "lkpServicoPontoCom" })
                                <span class="input-group-btn">
                                    <button class="btn btn-primary desabilitar" id="btnServicoPontoCom" type="button"><span class="glyphicon glyphicon-search"></span></button>
                                </span>
                            </div>
                            @Html.ValidationMessageFor(model => model.ServicoPontoCom)
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            @Html.LabelFor(model => model.NumSerie, new { @class = "control-label label-sm" })
                            @Html.TextBoxFor(model => model.NumSerie, new { @id = "lkpNumSerie", @class = "form-control  input-sm" })
                            @Html.ValidationMessageFor(model => model.NumSerie)
                        </div>
                    </div>
                    <div class="col-md-5" id="divNome">
                        <div class="form-group">
                            @Html.LabelFor(model => model.modeloNome, new { @class = "control-label label-sm" })
                            @Html.TextBoxFor(model => model.modeloNome, new { id = "lkpEquipamentoHomologadoStr", @class = "form-control  input-sm ", @disabled = "true" })
                            @Html.ValidationMessageFor(model => model.modeloNome)
                        </div>
                    </div>
                    <div class="col-md-4" id="divCampoCracha">
                        @Html.LabelFor(model => model.CampoCracha, new { @class = "label-sm" })
                        <div class="form-group input-group-sm">
                            <div class="radio-inline" data-toggle="radioCampoCracha" style="margin-top:-4px">
                                @Html.RadioButtonFor(model => model.CampoCracha, 0, new { id = "idRadioCodigo" })
                                <label class="label-sm" for="idRadioCodigo">Código</label>
                            </div>
                            <div class="radio-inline" data-toggle="radioCampoCracha" style="margin-top:-4px">
                                @Html.RadioButtonFor(model => model.CampoCracha, 1, new { id = "idRadioMatricula" })
                                <label class="label-sm" for="idRadioMatricula">Matrícula</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group input-group-sm">
                            @Html.LabelFor(model => model.DataInicioImportacao, new { @class = "control-label label-sm" })
                            <div class="input-group input-group-sm">
                                @Html.TextBoxFor(model => model.DataInicioImportacao, new { @class = "form-control input-sm MascDate datepickerpt", id = "dtInicioImp" })
                                <span class="input-group-btn">
                                    <button class="btn btn-primary" id="btnInicioImp" type="button"><span class="glyphicon glyphicon-calendar"></span></button>
                                </span>
                            </div>
                            @Html.ValidationMessageFor(model => model.DataInicioImportacao)
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group input-group-sm">
                            @Html.LabelFor(model => model.UltimoNSR, new { @class = "control-label label-sm" })
                            <div class="input-group input-group-sm">
                                @Html.TextBoxFor(model => model.UltimoNSR, new { @class = "form-control  input-sm " })
                                <span class="input-group-btn">
                                    <button class="btn btn-default" id="btnInfoNSR" type="button"><span class="glyphicon glyphicon-info-sign"></span></button>
                                </span>
                            </div>
                            @Html.ValidationMessageFor(model => model.UltimoNSR)
                        </div>
                    </div>
                    <div id="divImportacao">
                        <div class="col-md-2" id="divTempoRequisicao">
                            <div class="form-group">
                                @Html.LabelFor(model => model.TempoRequisicao, new { @class = "control-label label-sm" })
                                <div class="input-group input-group-sm">
                                    @Html.TextBoxFor(model => model.TempoRequisicao, new { @class = "form-control  input-sm " })
                                    <span class="input-group-addon" id="basic-addon2">Segundos</span>
                                </div>
                                @Html.ValidationMessageFor(model => model.TempoRequisicao)
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                @Html.LabelFor(model => model.ImportacaoAtivada, new { @class = "control-label label-sm" })
                                @Html.CheckBoxFor(model => model.ImportacaoAtivada, new { @class = "checkbox" })
                                @Html.ValidationMessageFor(model => model.ImportacaoAtivada)
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                @Html.LabelFor(model => model.IdTimeZoneInfo, new { @class = "control-label label-sm" })
                                @Html.DropDownListFor(m => m.IdTimeZoneInfo, new SelectList(Model.TimeZone, "Value", "Key"), new { @class = "form-control input-sm", style = "height: 25px;" })
                                @Html.ValidationMessageFor(model => model.IdTimeZoneInfo)
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-2">
                        <div class="form-group">
                            @Html.LabelFor(model => model.CodigoLocal, new { @class = "control-label label-sm" })
                            @Html.TextBoxFor(model => model.CodigoLocal, new { @class = "form-control  input-sm" }).IsReadonly(Model.Acao == Modelo.Acao.Alterar)
                            @Html.ValidationMessageFor(model => model.CodigoLocal)
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="form-group">
                            @Html.LabelFor(model => model.Local, new { @class = "control-label label-sm" })
                            @Html.TextBoxFor(model => model.Local, new { @class = "form-control  input-sm" }).IsReadonly(Model.Acao == Modelo.Acao.Alterar)
                            @Html.ValidationMessageFor(model => model.Local)
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="form-group">
                            @Html.LabelFor(model => model.empresaNome, new { @class = "control-label label-sm" })
                            <div class="input-group input-group-sm">

                                @Html.TextBoxFor(model => model.empresaNome, new { @class = "form-control  input-sm", id = "lkpEmpresa" })
                                <span class="input-group-btn">
                                    <button class="btn btn-primary desabilitar" id="btnEmpresa" type="button"><span class="glyphicon glyphicon-search"></span></button>
                                </span>
                            </div>
                            @Html.ValidationMessageFor(model => model.empresaNome)
                        </div>
                    </div>
                </div>

                <div class="row" id="DivDadosComunicacao">
                    <div class="col-md-4">
                        <div class="form-group">
                            @Html.LabelFor(model => model.TipoComunicacao, new { @class = "control-label label-sm disabled" })
                            @Html.DropDownListFor(model => model.TipoComunicacao, cwkPontoWeb.Models.Helpers.EnumHelper.GetSelectedItemList<Modelo.Listas.TipoComunicacao>(0), new { @class = "form-control input-sm", style = "height: 25px;" })
                            @Html.ValidationMessageFor(model => model.TipoComunicacao)
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="panel panel-default" style="margin-bottom:4px">
                            <div class="panel-heading" style="padding-top:1px; padding-bottom:2px">
                                @Html.LabelFor(model => model.TipoIP, new { @class = "label-sm" }) &nbsp;
                                <div class="radio-inline" data-toggle="radioTipo" style="margin-top:-4px">
                                    @Html.RadioButtonFor(model => model.TipoIP, 0, new { id = "idRadioIP", name = "rdioTipoIP" })
                                    <label class="label-sm" for="idRadioIP">IP</label>
                                </div>
                                <div class="radio-inline" data-toggle="radioTipo" style="margin-top:-4px">
                                    @Html.RadioButtonFor(model => model.TipoIP, 1, new { id = "idRadioDNS", name = "rdioTipoIP" })
                                    <label class="label-sm" for="idRadioDNS">DNS</label>
                                </div>
                            </div>
                            <div class="panel-body" style="padding-top:8px; padding-bottom:5px">
                                <div class="form-group input-group-sm">
                                    @Html.TextBoxFor(model => model.IP, new { @class = "form-control  input-sm ipdns" })
                                    @Html.ValidationMessageFor(model => model.IP)
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            @Html.LabelFor(model => model.Porta, new { @class = "control-label label-sm" })
                            @Html.TextBoxFor(model => model.Porta, new { @class = "form-control  input-sm" })
                            @Html.ValidationMessageFor(model => model.Porta)
                        </div>
                    </div>
                </div>
                <div class="row">

                    <div class="col-md-3">
                        <div class="form-group">
                            @Html.LabelFor(model => model.QtdDigitos, new { @class = "control-label label-sm" })
                            @Html.TextBoxFor(model => model.QtdDigitos, new { @class = "form-control  input-sm" })
                            @Html.ValidationMessageFor(model => model.QtdDigitos)
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            @Html.LabelFor(model => model.Senha, new { @class = "control-label label-sm" })
                            @Html.PasswordFor(model => model.Senha, new { @class = "form-control  input-sm", value = Model.Senha })
                            @Html.ValidationMessageFor(model => model.Senha)
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            @Html.LabelFor(model => model.Biometrico, new { @class = "control-label label-sm" })
                            @Html.CheckBoxFor(model => model.Biometrico, new { @class = "checkbox" })
                            @Html.ValidationMessageFor(model => model.Biometrico)
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            @Html.LabelFor(model => model.IdEquipamentoTipoBiometria, new { @class = "control-label label-sm disabled" })
                            @Html.DropDownListFor(m => m.IdEquipamentoTipoBiometria, new SelectList(tipoBiometria, "Id", "Descricao"), "Selecione", new { @id = "DllTipoBiometria", @class = "form-control input-sm", style = "height: 25px;" })
                            @Html.ValidationMessageFor(model => model.IdEquipamentoTipoBiometria)
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-default" id="pnlTipoSelecao">
                            <div class="panel-heading" style="padding-top:0; padding-bottom:0">
                                <div class="row">
                                    <div class="col-md-12">
                                        @Html.Label("Informações adicionais para REP's Homologados pelo INMETRO: ", new { @class = "control-label label-sm" })
                                    </div>
                                </div>
                            </div>
                            <div class="panel-body" style="padding-top:0; padding-bottom:0">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.LoginRep, new { @class = "control-label label-sm" })
                                        @Html.TextBoxFor(model => model.LoginRep, new { @class = "form-control input-sm" })
                                        @Html.ValidationMessageFor(model => model.LoginRep)
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.SenhaRep, new { @class = "control-label label-sm" })
                                        @Html.PasswordFor(model => model.SenhaRep, new { @class = "form-control input-sm", value = Model.SenhaRep })
                                        @Html.ValidationMessageFor(model => model.SenhaRep)
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.CpfRep, new { @class = "control-label label-sm" })
                                        @Html.TextBoxFor(model => model.CpfRep, new { @class = "form-control  input-sm cpf" })
                                        @Html.ValidationMessageFor(model => model.CpfRep)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel-footer">
                <div class="row">
                    <div class="col-xs-12 center-block">
                        <div style="text-align: right">
                            <button type="submit" class="btn btn-success salvando">
                                <span class="glyphicon glyphicon-ok-circle"></span> &nbsp;Salvar&nbsp;&nbsp;
                            </button>
                            <a class="btn btn-danger"
                               href="@Url.Action("Grid", "Rep")">
                                <span class="glyphicon glyphicon-remove salvando"></span> Cancelar
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<script>
    $(document).ready(function () {
        cwk_EventoConsulta("#btnEmpresa", "#lkpEmpresa", "EventoConsulta", "Empresa", "");
        cwk_EventoConsulta("#btnServicoPontoCom", "#lkpServicoPontoCom", "EventoConsulta", "ServicoPontoCom", "");
        
        $("#lkpEquipamentoHomologadoStr").attr('disabled', true);
        if ('@Model.IntegraComunicador' === 'True') {
            $("#lkpEquipamentoHomologadoStr").css('color', 'green');
        }
        else {
            $("#lkpEquipamentoHomologadoStr").css('color', 'red');
        }
        HabilitaDesabilitaIP();
        validaTipoIP('@Model.TipoIP');
        ExibeDivImportacao('@Convert.ToInt32(Model.Relogio)', '@Convert.ToBoolean(Model.EquipamentoHomologado.ServicoComunicador)');
        ExibeEscolhaCampoCracha(@Convert.ToInt32(Model.Relogio));
        cwk_DataCalendario('#btnInicioImp', '#dtInicioImp');
    });

    $("#TipoComunicacao").change(function () {
        HabilitaDesabilitaIP();
    });

    function HabilitaDesabilitaIP() {
        if ($("#TipoComunicacao").val() === "1") {
            $("#IP").val("");
            $("#IP").prop('disabled', true);
        }
        else {
            $("#IP").prop('disabled', false);
        }
    }

    $('input:radio[name=TipoIP]').change(function () {
        validaTipoIP($(this).val());
    });

    function validaTipoIP(valor) {


        if (valor === 0) {
            $('.ipdns').mask('099.099.099.099');
        }
        else if (valor === 1) {
            $('.ipdns').unmask();
        }
    }

    $('#lkpNumSerie').blur(function () {
        var NumSerieVal = $(this).val();
        BuscaEquipamentoHomologado(NumSerieVal);
    });

    $('#btnInfoNSR').click(function () {
        cwkNotificacaoTit("Último NSR", "Valor utilizado para indicar a partir de qual NSR a importação deve iniciar, quando valor for 0 a importação inicia apartir da data informada no campo \"Início Importação\", quando maior que 0 a data de Início da Importação é desconsiderada.")
    });

    function BuscaEquipamentoHomologado(NumSerieVal) {
        $.ajax({
            url: '/Rep/BuscaEquipamentoHomologado',
            type: 'GET',
            dataType: 'json',
            data: { 'NumSerie': NumSerieVal, 'NumRelogio': $('#NumRelogio').val() },
            beforeSend: function () {
                $("#loading").modal();
            },
            success: function (ret) {
                if (ret.Successo === true) {
                    $("#lkpEquipamentoHomologadoStr").val(ret.EquipamentoHomNome);
                    $("#IdEquipamentoHomologado").val(ret.EquipamentoHomID);
                    $("#UltimoNSR").val(ret.UltimoNSR);
                    $("#Relogio").val(ret.IdentificacaoRelogio);
                    if (ret.IntegraComunicador === true) {
                        $("#lkpEquipamentoHomologadoStr").css('color', 'green');
                    }
                    else {
                        $("#lkpEquipamentoHomologadoStr").css('color', 'red');
                    }

                    var DllTipoBiometria = $("#DllTipoBiometria");
                    DllTipoBiometria.empty(); 

                    DllTipoBiometria.append(new Option("Selecione", "0"));
                    
                    $.each(ret.EquipamentoTipoBiometria, function (index, item) {
                        var p = new Option(item.Descricao, item.Id);
                        DllTipoBiometria.append(p);
                    });

                    ExibeDivImportacao(ret.IdentificacaoRelogio, ret.ServicoComunicador);
                    ExibeEscolhaCampoCracha(ret.IdentificacaoRelogio);
                    $("#dtInicioImp").focus();
                } else {
                    cwkErroTit('Erro!', ret.Erro);
                }
            },
            complete: function () {
                $("#loading").modal('hide');
            }
        });
    }

    function ExibeEscolhaCampoCracha(NumeroFabricante) {
        if (NumeroFabricante === 22) {
            $("#divCampoCracha").show();
            $("#divNome").removeClass("col-md-9").addClass("col-md-5");
        }
        else {
            $("#divCampoCracha").hide();
            $("#divNome").removeClass("col-md-5").addClass("col-md-9");
        }
    }

    function ExibeDivImportacao(NumeroFabricante, ServicoComunicador) {
        if (NumeroFabricante === 17 || NumeroFabricante === 22) {
            $("#DivDadosComunicacao").hide();
        }
        else {
            $("#DivDadosComunicacao").show();
        }
    }

    $('form').submit(function () {
        if ($(this).valid()) {
            $("#lkpEquipamentoHomologadoStr").attr('disabled', false);
        }
    });

    $(":input[type='text']:enabled:visible:first").focus();

     
</script>
@if (ViewBag.Consultar == 1)
{
    <script>
        $(document).ready(function () {
            $('form').find('input, textarea, button, select').attr('disabled', 'disabled');
        })
    </script>
}